
var admin_id = 0;

nowjs.on('connect', function(){
  if(this.now.name == "admin") {
        admin_id = this.user.clientId;
	console.log("Joined: " + this.now.name+ " "+ this.user.clientId);
  } else {

	if(admin_id!=0){
	  this.now.room = this.user.clientId;
          user_name = this.now.name;
	  nowjs.getGroup(this.now.room).addUser(admin_id);
	  nowjs.getGroup(this.now.room).addUser(this.user.clientId);
	  nowjs.getClient(admin_id,function(){
			this.now.add_client(user_name,this.user.clientId);
       	  });
	  console.log("Joined: " + this.now.name+ " "+ this.user.clientId);
	  }else{
	    this.now.receiveMessage("SErver","Admin is offline.Contact later!");
            this.now.deletechat();
	 }
  }
});


nowjs.on('disconnect', function(){
  console.log("Left: " + this.now.name);
});

everyone.now.distributeMessage = function(message,room){
  nowjs.getGroup(room).now.receiveMessage(this.now.name, message);
};


--------------------

$(document).ready(function(){
  now.receiveMessage = function(name, message){
    $("#messages").append("<br>" + name + ": " + message);
  }

  now.deletechat = function(){
    $("#chat").html("");
  }
  
  now.add_client = function(name, client_id){
    html = '<p style="cursor:pointer;" class="change" id='+client_id+'>'+name+'</p>';
    $("#users").append(html);
  }
 
  $("#send-button").click(function(){
    now.distributeMessage($("#text-input").val(),this.now.clientId);
    $("#text-input").val("");
  });
  now.name = prompt("What's your name?", "");

});